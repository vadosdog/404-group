# Тестовое задание PHP. 404-group

## Задание
Ваша задача: создать прототип микросервиса, обеспечивающий **эмуляцию**
отправки сообщений в популярные мессенджеры (Viber, Telegram, WhatsApp).

Приложение должно обладать следующим функционалом:
- прием сообщений по API и отправка их в мессенджеры (с указанием
идентификатора пользователя для каждого мессенджера);
- возможность отложенной отправки сообщений по дате/времени;
- в случае неудачной отправки сообщения, нужно повторить попытку N-ое
количество раз, но это не должно влиять на доставляемость других
сообщений;
- исключение возможности многократной отправки одного и того же
сообщения (с одним и тем же содержимым) одному получателю;
- возможность отправки одного сообщения нескольким получателям на
несколько мессенджеров в рамках одного запроса;

**Важно:**

Нужно сделать именно эмуляцию отправки, непосредственную интеграцию с
мессенджерами делать не нужно.

Параметры запроса должны проходить валидацию (требования валидации на
ваше усмотрение).

Задание нужно выполнить на PHP7 (ждем от Вас использования строгих типов
аргументов функций “type hinting” и возвращаемых типов) и прислать его нам
вместе с README, в котором должна быть инструкция по развертыванию/запуску
и описание API-запросов.

Основная логика должна быть покрыта тестами.

Использование фреймворков, пакетов и т.д. — на вашей совести, однако выбор
необходимо будет обосновать там же в README.

## Решение

### Выбор фреймоврков и пакетов

* **Lumen** - микрофреймворк для обеспечения Апи с встроенным функционалом очередей 
* **illuminate/notifications** - пакет обеспечивающий возвомжность удобно управлять уведомлениями через каналы
* **ramsey/uuid** - вспомогательная библиотека для генерации инкальных полей. Почему то не включена в стандартный lumen

### установка

* Установить зависимости`composer i`
* Создать БД
* Скопировать `.env.example` в `.env` указать настройки
* Запустить миграции `php artisan migrate`
* запустить сервер `php -S localhost:8000`
* запустить обработчик очередей `php artisan queue:work` или настроить `supervisor` [example](https://lumen.laravel.com/docs/5.1/queues#supervisor-configuration) 


### использование

#### добавление записи

**Method**
POST

**Path**
/message/

**Request Data**

| поле | тип | описание | обязательный |
| --- | --- | --- | --- |
| message | string | поле сообщения | да |
| send_at | string (datetime:Y-m-d H:i:s) | время отправки сообщения | нет |
| recipients | array | массив получателей | да |
| recipients[*][service] | string | "имя сервиса enum(viber,telegram,whatsup)" | да |
| recipients[*][uid] | string | идентификатор получателя | да |

Пример
```
{
    "message": "Happy new year!",
    "send_at": "2019-12-31 23:59:59",
    "recipients": [
        {
            "service": "viber",
            "uid": "79111111111"
        },
        {
            "service": "whatsup",
            "uid": "79111111111"
        },
        {
            "service": "telegram",
            "uid": "79111111111"
        }
    ]
}
```

**Response**

200 - {"message": "ok"} - сообщение добавлено в очередь
